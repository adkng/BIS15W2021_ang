---
title: "Data Visualization: `ggplot` part 2"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

## Learning Goals
*At the end of this exercise, you will be able to:*    
1. Produce boxplots using `ggplot.`  
2. Customize labels on axes using `labs` and `themes`.  
3. Use `color`, `fill`, and `group` to customize plots and improve overall aesthetics.  

## Breakout Rooms  
Please take 5-8 minutes to check over your answers to HW 8 in your group. If you are stuck, please remember that you can check the key in [Joel's repository](https://github.com/jmledford3115/BIS15LW2021_jledford).  

##Resources
- [ggplot2 cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)
- [`ggplot` themes](https://ggplot2.tidyverse.org/reference/ggtheme.html)
- [Rebecca Barter `ggplot` Tutorial](http://www.rebeccabarter.com/blog/2017-11-17-ggplot2_tutorial/)

## Load the libraries
```{r message=FALSE, warning=FALSE}
library(palmerpenguins)
```

## Review
Now that you have been introduced to `ggplot`, let's practice a few more plot types. Remember that plots are built in layers: **plot= data + geom_ + aesthetics**. We have to specify each of these in order for a plot to be produced. If you get stuck, it is often helpful to stop and make a quick sketch of what you want or expect to see on a piece of scratch paper.

Remember, plots in R are built up via layers. The way to build up layers is very text-specific. Refer to the equation up top!

Pop-Quiz: What's the best way to make a ggplot based on one type of axis (the count)? `Geom_bar()`

Let's review using the `penguins` data. First, get an idea of the structure: Are the data tidy? Are there NA's? Are the variables discrete, categorical, or continuous?
```{r}
penguins
```


In a previous lab, we asked how many penguins are on each island.
```{r}
penguins %>% count(island, species, sort = F)
```

What if we wanted a plot that showed the number of measured penguins per species and the number of measured penguins per island? Straight counts get better mileage out of `geom_bar()`.
```{r}
penguins %>% 
  group_by(island) %>% 
  ggplot(aes(x = species)) +
  geom_bar()
```

How about average bill length by sex?
```{r}
penguins %>% 
  count(sex)
```
The NA's are probably juveniles... so filter out!
```{r}
penguins %>%
  filter(sex != "NA") %>% 
  group_by(sex) %>% 
  summarise(mean_bill_length = mean(bill_length_mm)) %>%  
  ggplot(aes(x = sex, y = mean_bill_length)) +
  geom_col()
```

Can you use geom_bar() for continuous variables? Can you make a bar plot using bill_length in mm?
No, it would be kind of useless. If you want to show a range of values, do a different type of plot!

## Box Plots
For the next series of examples, we will use the `homerange` data.  **Database of vertebrate home range sizes.**   

Reference: Tamburello N, Cote IM, Dulvy NK (2015) Energy and the scaling of animal space use. The American Naturalist 186(2):196-211. http://dx.doi.org/10.1086/682070.  
Data: http://datadryad.org/resource/doi:10.5061/dryad.q5j65/1  

```{r message=FALSE, warning=FALSE}
homerange <- read_csv(here("lab9", "data", "Tamburelloetal_HomeRangeDatabase.csv"))
homerange
```

Boxplots help us visualize a range of values. So, on the x-axis we typically have something *categorical* (e.g. family) and the y-axis is the *range* (or somekind of continuous measurement). In the case below, we are plotting `log10.mass` by taxonomic class in the `homerange` data. `geom_boxplot()` is the geom type for a standard box plot. The center line in each box represents the median, not the mean.

Let's look at the variable `log10.mass` grouped by taxonomic class.
```{r}
homerange %>% 
  group_by(class) %>% 
  summarize(min_log10.mass=min(log10.mass),
            max_log10.mass=max(log10.mass),
            median_log10.mass=median(log10.mass))
```
The x column would be `class` because it is a categorical variable. The box plot will be made via these classes!

```{r}
homerange %>% 
  ggplot(aes(x = class, y = log10.mass)) +
  geom_boxplot()
```
The line in the middle represents the *median*, not the mean. Double check your data with a table! The black dots are outliers,

## Practice
1. There are more herbivores than carnivores in the homerange data, but how do their masses compare? Make a summary and boxplot that compares their masses. Use `log10.mass`.
```{r}
homerange %>% 
  group_by(trophic.guild) %>%
  ggplot(aes(x = trophic.guild, y = log10.mass)) +
  geom_boxplot()
```

```{r}
homerange %>% 
  group_by(trophic.guild) %>% 
  summarise(mean_log10mass = mean(log10.mass),
            min_log10mass = min(log10.mass),
            max_log10mass = max(log10.mass),
            median_log10mass = median(log10.mass),
            total_n = n())
```

2. Have a closer look at carnivorous mammals. Summarize and visualize the range of log10.mass by family.
```{r}
homerange %>% 
  filter(trophic.guild == "carnivore", class == "mammalia") %>%
  group_by(family) %>% 
  summarise(mean_log10mass = mean(log10.mass),
            min_log10mass = min(log10.mass),
            max_log10mass = max(log10.mass)) %>% 
  arrange(desc(min_log10mass))
```

3. Now use a boxplot to visualize the range of body mass by family of carnivore.
```{r}
homerange %>% 
  filter(trophic.guild == "carnivore", class == "mammalia") %>%
  ggplot(aes(x = reorder(family, log10.mass), y = log10.mass)) +
  geom_boxplot() +
  coord_flip()
```

## That's it, let's take a break!   

-->[Home](https://jmledford3115.github.io/datascibiol/)