---
title: "summarize practice, `count()`, `across()`"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

## Learning Goals
*At the end of this exercise, you will be able to:*    
1. Produce clear, concise summaries using a variety of functions in `dplyr` and `janitor.`  
2. Use the `across()` operator to produce summaries across multiple variables.  

## Breakout Rooms  
Please take 5-8 minutes to check over your answers to the HW in your group. If you are stuck, please remember that you can check the key in [Joel's repository](https://github.com/jmledford3115/BIS15LW2021_jledford).  

## Load the libraries
```{r message=FALSE, warning=FALSE}
library("tidyverse")
library("janitor")
library("skimr")
library("palmerpenguins")
```

## Review
The summarize() and group_by() functions are powerful tools that we can use to produce clean summaries of data. Especially when used together, we can quickly group variables of interest and save time. Let's do some practice with the [palmerpenguins(https://allisonhorst.github.io/palmerpenguins/articles/intro.html) data to refresh our memory.
```{r}
glimpse(penguins)
```

As biologists, a good question that we may ask is how do the measured variables differ by island (on average)?
```{r}
penguins %>% 
  group_by(island) %>% 
  summarize(mean_body_mass_g=mean(body_mass_g),
            n=n()) # tells you # observations
```
Some islands have "NA"... but measured body mass is measured for some individuals! When we use the summary() functions, if there is even ONE NA, you will get an NA. But, you can use `is.na()` to get rid of them, and use `number_NAs()` to find out how many there are.

Why do we have NA here? Do all of these penguins lack data?
```{r}
penguins %>% 
  group_by(island) %>% 
  summarize(number_NAs=sum(is.na(body_mass_g)))
```

Well, that won't work so let's remove the NAs and recalculate.
```{r}
penguins %>% 
  filter(!is.na(body_mass_g)) %>% 
  group_by(island) %>% 
  summarize(mean_body_mass_g=mean(body_mass_g),
            sd_body_mass_g=sd(body_mass_g),
            n=n())
```

What if we are interested in the number of observations (penguins) by species and island?
```{r}
names(penguins)
```

```{r}
penguins %>% 
  group_by(island, species) %>% 
  summarize(n=n(), .groups= 'keep')#the .groups argument here just prevents a warning message
```
Here, you get the number of individuals within that species measured! Some islands have more than 1 species of penguin.

Do islands have more than 1 species? The only island that has one species is Torgersen. When you do two variables, keep in mind that if you reverse the order in the function... you get a slightly different results.
```{r}
penguins %>% 
  group_by(species, island) %>% 
  summarize(n=n(), .groups= 'keep')
```


## Counts
Although these summary functions are super helpful, oftentimes we are mostly interested in counts. The [janitor package](https://garthtarr.github.io/meatR/janitor.html) does a lot with counts, but there are also functions that are part of dplyr that are useful.  

`count()` is an easy way of determining how many observations you have within a column. It acts like a combination of `group_by()` and `n()`.
```{r}
penguins %>% 
  count(island, sort = T) #sort=T sorts the column in descending order
```
This is the number of observations per island. If you compare this with summarize...

Compare this with `summarize()` and `group_by()`.
```{r}
penguins %>% 
  group_by(island) %>% 
  summarize(n=n())
```
It is the same result! It is basically a combination of `group_by()` and `summarize()`, but is a shorthand way of saying it.

You can also use `count()` across multiple variables.
```{r}
penguins %>% 
  count(island, species, sort = F) %>% 
  arrange(desc(n)) #you can use the arrange() function here.
```

# So, what function **should** you use?
Well, Ledford really likes `tabyl()`.

For counts, I am starting to prefer `tabyl()`. Lots of options are supported in [tabyl](https://cran.r-project.org/web/packages/janitor/vignettes/tabyls.html)
```{r}
penguins %>% 
  tabyl(species, island)
```

```{r}
penguins %>% 
  tabyl(species, island) %>% 
  adorn_percentages() %>%
  adorn_pct_formatting(digits = 1) %>%
  adorn_ns()
```

## Practice
1. Produce a summary of the mean for bill_length_mm, bill_depth_mm, flipper_length_mm, and body_mass_g within Adelie penguins only. Be sure to provide the number of samples.
```{r}
names(penguins)
penguins %>% 
  filter(species == "Adelie") %>%
  filter(!is.na(bill_length_mm) & !is.na(bill_depth_mm) & !is.na(flipper_length_mm) & !is.na(body_mass_g)) %>% 
  summarize(mean_bill_length = mean(bill_length_mm),
          mean_bill_depth = mean(bill_depth_mm),
          mean_flipper_length = mean(flipper_length_mm),
          mean_body_mass = mean(body_mass_g),
          samples = n())
```
If you are using a filter() across multiple variables, you may lose data! You should deal with them on a smaller, more specific scale. You can be careful by using the `na.rm = T` when you create the summarize.


Ledford's work
```{r}
penguins %>% 
  summarize(mean_bill_length_mm = mean(bill_length_mm, na.rm = T))
```

2. How does the mean of `bill_length_mm` compare between penguin species?
```{r}
penguins %>% 
  select(species, bill_length_mm) %>% 
  filter(!is.na(bill_length_mm)) %>% 
  group_by(species) %>% 
  summarize(mean_bill_length = mean(bill_length_mm))
```

Ledford's work
```{r}
penguins %>% 
  group_by(species) %>%
  summarize(mean_bill_length_mm = mean(bill_length_mm, na.rm = T))
```


3. For some penguins, their sex is listed as NA. Where do these penguins occur?
```{r}
names(penguins)
penguins %>% 
  group_by(species, island) %>% 
  summarize(number_NAs=sum(is.na(sex)))
```

Ledford's work
```{r}

```


## `across()`
Last time we had some great questions on how to use `filter()` and `select()` across multiple variables. There is a new function in dplyr called `across()` which is designed to work across multiple variables. Have a look at Rebecca Barter's awesome blog [here](http://www.rebeccabarter.com/blog/2020-07-09-across/) as I am following her below.  

What if we wanted to apply summarize in order to produce distinct counts over multiple variables; i.e. species, island, and sex? Although this isn't a lot of coding you can image that with a lot of variables it would be cumbersome.
```{r}
penguins %>%
  summarize(distinct_species = n_distinct(species),
            distinct_island = n_distinct(island),
            distinct_sex = n_distinct(sex))
```


By using `across()` we can reduce the clutter and make things cleaner. 
```{r}
penguins %>%
  summarize(across(c(species, island, sex), n_distinct)) #c() is the columns you want it to run through.. "summarize across the combination of species, island, and sex with the following function"
```

This is very helpful for continuous variables.
```{r}
penguins %>%
  summarize(across(contains("mm"), mean, na.rm=T))
```

`group_by` also works.
```{r}
penguins %>%
  group_by(sex) %>% 
  summarize(across(contains("mm"), mean, na.rm=T)) # summarize across any column that contains "MM" using the mean function while removing the NA data
```

Here we summarize across all variables. Without summarize_all, we would have to type allll the columns out.. yikes!
```{r}
penguins %>%
  summarise_all(n_distinct)
```

Operators can also work, here I am summarizing `n_distinct()` across all variables except `species`, `island`, and `sex`.
```{r}
penguins %>%
  summarise(across(!c(species, island, sex), 
                   n_distinct))
```

All variables that include "bill"...all of the other dplyr operators also work.
```{r}
penguins %>%
  summarise(across(starts_with("bill"), n_distinct))
```

## Practice
1. Produce separate summaries of the mean and standard deviation for bill_length_mm, bill_depth_mm, and flipper_length_mm for each penguin species. Be sure to provide the number of samples.  

Take the mean first.
```{r}
penguins %>%
  group_by(species) %>% 
  summarize(across(contains("mm"), mean, na.rm = TRUE),
            n_samples = n())
```

```{r}
penguins %>%
  group_by(species) %>% 
  summarize(across(contains("mm"), sd, na.rm = TRUE),
            n_samples = n())
```


## Wrap-up  

Please review the learning goals and be sure to use the code here as a reference when completing the homework.  
-->[Home](https://jmledford3115.github.io/datascibiol/)